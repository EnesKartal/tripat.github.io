<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trip Atma ZamanÄ±!</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #333;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 600px;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
      font-weight: 700;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
      line-height: 1.6;
    }

    .form-group {
      margin-bottom: 25px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #444;
      font-size: 1em;
    }

    input[type="text"],
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1em;
      font-family: inherit;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }

    input[type="text"]:focus,
    textarea:focus {
      outline: none;
      border-color: #667eea;
      background-color: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.5;
    }

    .char-count {
      text-align: right;
      font-size: 0.85em;
      color: #999;
      margin-top: 5px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    button {
      flex: 1;
      padding: 14px 24px;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background-color: #f5f5f5;
      color: #666;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
    }

    .hidden {
      display: none !important;
    }

    .result-container {
      text-align: center;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .result-container h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 2em;
    }

    .result-container p {
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
      font-size: 1.1em;
    }

    .link-box {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border: 2px dashed #667eea;
    }

    .link-box a {
      color: #667eea;
      text-decoration: none;
      font-size: 1.2em;
      font-weight: 600;
      word-break: break-all;
      display: inline-block;
      transition: color 0.3s ease;
    }

    .link-box a:hover {
      color: #764ba2;
      text-decoration: underline;
    }

    .copy-btn {
      margin-top: 15px;
      background-color: #667eea;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .copy-btn:hover {
      background-color: #5568d3;
    }

    .success-message {
      background-color: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
    }

    .success-message.show {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }

    .step-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      gap: 10px;
    }

    .step {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      background-color: #e0e0e0;
      color: #999;
      transition: all 0.3s ease;
    }

    .step.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .step.completed {
      background-color: #4CAF50;
      color: white;
    }

    .trip-message-container {
      text-align: center;
      animation: fadeIn 0.5s ease-in;
    }

    .trip-message-container h2 {
      color: #e74c3c;
      margin-bottom: 20px;
      font-size: 2.5em;
      font-weight: 700;
    }

    .trip-person {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white;
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      font-size: 1.5em;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(238, 90, 111, 0.4);
    }

    .trip-reason {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      padding: 25px;
      border-radius: 15px;
      margin: 20px 0;
      font-size: 1.2em;
      line-height: 1.8;
      color: #2d3436;
      border-left: 5px solid #e74c3c;
      text-align: left;
    }

    .trip-reason-label {
      font-weight: 600;
      color: #e74c3c;
      margin-bottom: 10px;
      display: block;
    }

    .emoji-large {
      font-size: 4em;
      margin-bottom: 20px;
      display: block;
    }

    @media (max-width: 600px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 2em;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ Trip Atma ZamanÄ±!</h1>
    <p class="subtitle">Birisi sana trip atÄ±yorsa, bunu hemen Ã¶ÄŸren! AÅŸaÄŸÄ±daki formu doldurarak kendi isminizi, trip atmak istediÄŸiniz kiÅŸinin adÄ±nÄ± ve sebebini belirtin, ardÄ±ndan linkini paylaÅŸÄ±n!</p>
    
    <div class="step-indicator">
      <div class="step active" id="step1-indicator">1</div>
      <div class="step" id="step2-indicator">2</div>
      <div class="step" id="step3-indicator">3</div>
    </div>

    <!-- AdÄ±m 1: Ä°simler -->
    <div id="step1">
      <div class="form-group">
        <label for="yourName">Kendi isminizi yazÄ±n:</label>
        <input type="text" id="yourName" placeholder="Ã–rn: Ahmet, AyÅŸe, Mehmet..." autocomplete="off">
      </div>
      <div class="form-group">
        <label for="person">Trip atacaÄŸÄ±nÄ±z kiÅŸinin adÄ±nÄ± yazÄ±n:</label>
        <input type="text" id="person" placeholder="Ã–rn: Zeynep, Can, Elif..." autocomplete="off">
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="nextStep()">Devam Et â†’</button>
      </div>
    </div>
    
    <!-- AdÄ±m 2: Sebep Yazma -->
    <div id="step2" class="hidden">
      <div class="form-group">
        <label for="reason">Trip sebebinizi yazÄ±n:</label>
        <textarea id="reason" placeholder="Ã–rn: BugÃ¼n Ã§ok geÃ§ kaldÄ±, beni umursamÄ±yor, hep benden bekliyor..." maxlength="500"></textarea>
        <div class="char-count"><span id="charCount">0</span>/500</div>
      </div>
      <div class="button-group">
        <button class="btn-secondary" onclick="previousStep()">â† Geri</button>
        <button class="btn-primary" onclick="generateLink()">Link OluÅŸtur âœ¨</button>
      </div>
    </div>
    
    <!-- AdÄ±m 3: SonuÃ§ -->
    <div id="result" class="hidden">
      <div class="result-container">
        <h2>ğŸ‰ Trip MesajÄ±nÄ±z HazÄ±r!</h2>
        <p>Tebrikler, trip mesajÄ±nÄ±zÄ± baÅŸarÄ±yla oluÅŸturduk. AÅŸaÄŸÄ±daki linke tÄ±klayarak veya kopyalayarak trip mesajÄ±nÄ±zÄ± paylaÅŸabilirsiniz.</p>
        <div class="link-box">
          <a id="tripLink" href="#" target="_blank"></a>
        </div>
        <button class="copy-btn" onclick="copyLink()">ğŸ“‹ Linki Kopyala</button>
        <div class="success-message" id="copySuccess">âœ“ Link panoya kopyalandÄ±!</div>
        <div class="button-group" style="margin-top: 30px;">
          <button class="btn-primary" onclick="resetForm()">ğŸ”„ Yeni Trip OluÅŸtur</button>
        </div>
      </div>
    </div>

    <!-- Trip MesajÄ± GÃ¶rÃ¼ntÃ¼leme -->
    <div id="tripMessage" class="hidden">
      <div class="trip-message-container">
        <span class="emoji-large">ğŸ˜¤</span>
        <h2>Sana Trip AtÄ±yor!</h2>
        <div class="trip-reason" style="margin-bottom: 20px;">
          <div style="font-size: 1.3em; line-height: 1.8; text-align: center;">
            <strong id="tripFromName" style="color: #667eea;"></strong> kiÅŸisi, 
            <strong id="tripToName" style="color: #e74c3c;"></strong> kiÅŸisine trip atÄ±yor!
          </div>
        </div>
        <div class="trip-reason">
          <span class="trip-reason-label">Trip Sebebi:</span>
          <div id="tripReasonText"></div>
        </div>
        <div class="button-group" style="margin-top: 30px;">
          <button class="btn-primary" onclick="goToHome()">ğŸ  Ana Sayfaya DÃ¶n</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let yourName = '';
    let personName = '';
    let reason = '';
    let shortLink = '';

    // Karakter sayacÄ±
    const reasonTextarea = document.getElementById('reason');
    const charCount = document.getElementById('charCount');

    reasonTextarea.addEventListener('input', function() {
      const length = this.value.length;
      charCount.textContent = length;
      if (length > 450) {
        charCount.style.color = '#e74c3c';
      } else {
        charCount.style.color = '#999';
      }
    });

    // AdÄ±m 1: Ä°sim kontrolÃ¼ ve sonraki adÄ±ma geÃ§iÅŸ
    function nextStep() {
      yourName = document.getElementById('yourName').value.trim();
      personName = document.getElementById('person').value.trim();
      
      if (!yourName) {
        alert("âš ï¸ LÃ¼tfen kendi isminizi girin.");
        document.getElementById('yourName').focus();
        return;
      }

      if (yourName.length < 2) {
        alert("âš ï¸ LÃ¼tfen en az 2 karakter uzunluÄŸunda bir isim girin.");
        document.getElementById('yourName').focus();
        return;
      }

      if (!personName) {
        alert("âš ï¸ LÃ¼tfen trip atacaÄŸÄ±nÄ±z kiÅŸinin adÄ±nÄ± girin.");
        document.getElementById('person').focus();
        return;
      }

      if (personName.length < 2) {
        alert("âš ï¸ LÃ¼tfen en az 2 karakter uzunluÄŸunda bir isim girin.");
        document.getElementById('person').focus();
        return;
      }

      // AdÄ±m gÃ¶stergelerini gÃ¼ncelle
      document.getElementById('step1-indicator').classList.remove('active');
      document.getElementById('step1-indicator').classList.add('completed');
      document.getElementById('step2-indicator').classList.add('active');

      // AdÄ±mlarÄ± deÄŸiÅŸtir
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
      
      // Textarea'ya odaklan
      setTimeout(() => {
        document.getElementById('reason').focus();
      }, 100);
    }

    // Ã–nceki adÄ±ma dÃ¶n
    function previousStep() {
      // AdÄ±m gÃ¶stergelerini gÃ¼ncelle
      document.getElementById('step2-indicator').classList.remove('active');
      document.getElementById('step1-indicator').classList.remove('completed');
      document.getElementById('step1-indicator').classList.add('active');

      // AdÄ±mlarÄ± deÄŸiÅŸtir
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
      
      // Ä°lk input'a odaklan
      setTimeout(() => {
        document.getElementById('yourName').focus();
      }, 100);
    }

    // Link oluÅŸturma fonksiyonu
    function generateLink() {
      reason = document.getElementById('reason').value.trim();
      
      if (!reason) {
        alert("âš ï¸ LÃ¼tfen trip sebebinizi yazÄ±n.");
        document.getElementById('reason').focus();
        return;
      }

      if (reason.length < 5) {
        alert("âš ï¸ LÃ¼tfen en az 5 karakter uzunluÄŸunda bir sebep yazÄ±n.");
        document.getElementById('reason').focus();
        return;
      }

      // KÄ±sa link oluÅŸtur
      shortLink = generateShortLink(yourName, personName, reason);

      // AdÄ±m gÃ¶stergelerini gÃ¼ncelle
      document.getElementById('step2-indicator').classList.remove('active');
      document.getElementById('step2-indicator').classList.add('completed');
      document.getElementById('step3-indicator').classList.add('active');

      // SonuÃ§ ekranÄ±nÄ± gÃ¶ster
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');

      // Linki ayarla
      const tripLink = document.getElementById('tripLink');
      tripLink.href = shortLink;
      tripLink.innerText = shortLink;
    }

    // KÄ±sa link oluÅŸturma fonksiyonu
    function generateShortLink(fromName, toName, reason) {
      // KullanÄ±cÄ± adÄ±, trip atÄ±lan kiÅŸi ve reason bilgilerini birleÅŸtirip Base64 ile encode et
      const data = `${fromName}|${toName}|${reason}`;
      
      // Mevcut sayfanÄ±n base URL'ini al (query string olmadan)
      const baseUrl = window.location.href.split('?')[0];
      
      // UTF-8 karakterleri iÃ§in Ã¶nce encodeURIComponent kullan, sonra Base64
      const encoded = btoa(encodeURIComponent(data))
        .replace(/\+/g, '-')  // URL-safe karakterler
        .replace(/\//g, '_')
        .replace(/=+$/, '');   // Padding'i kaldÄ±r
      
      return `${baseUrl}?t=${encoded}`;
    }

    // Linki kopyalama fonksiyonu
    function copyLink() {
      const linkText = document.getElementById('tripLink').innerText;
      
      // Modern clipboard API kullan
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(linkText).then(() => {
          showCopySuccess();
        }).catch(() => {
          fallbackCopy(linkText);
        });
      } else {
        fallbackCopy(linkText);
      }
    }

    // Fallback kopyalama yÃ¶ntemi
    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.select();
      
      try {
        document.execCommand('copy');
        showCopySuccess();
      } catch (err) {
        alert('Kopyalama baÅŸarÄ±sÄ±z oldu. LÃ¼tfen linki manuel olarak kopyalayÄ±n.');
      }
      
      document.body.removeChild(textArea);
    }

    // Kopyalama baÅŸarÄ± mesajÄ±
    function showCopySuccess() {
      const successMsg = document.getElementById('copySuccess');
      successMsg.classList.add('show');
      setTimeout(() => {
        successMsg.classList.remove('show');
      }, 3000);
    }

    // Formu sÄ±fÄ±rla
    function resetForm() {
      yourName = '';
      personName = '';
      reason = '';
      shortLink = '';
      
      document.getElementById('yourName').value = '';
      document.getElementById('person').value = '';
      document.getElementById('reason').value = '';
      charCount.textContent = '0';
      charCount.style.color = '#999';
      
      // AdÄ±m gÃ¶stergelerini sÄ±fÄ±rla
      document.getElementById('step1-indicator').classList.remove('completed');
      document.getElementById('step1-indicator').classList.add('active');
      document.getElementById('step2-indicator').classList.remove('active', 'completed');
      document.getElementById('step3-indicator').classList.remove('active', 'completed');
      
      // AdÄ±mlarÄ± sÄ±fÄ±rla
      document.getElementById('result').classList.add('hidden');
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
      
      // Ä°lk input'a odaklan
      setTimeout(() => {
        document.getElementById('yourName').focus();
      }, 100);
    }

    // Enter tuÅŸu ile form gÃ¶nderimi
    document.getElementById('yourName').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('person').focus();
      }
    });

    document.getElementById('person').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        nextStep();
      }
    });

    document.getElementById('reason').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && e.ctrlKey) {
        e.preventDefault();
        generateLink();
      }
    });

    // Ana sayfaya dÃ¶n fonksiyonu
    function goToHome() {
      window.location.href = window.location.pathname;
    }

    // URL parametrelerinden trip bilgisini oku ve gÃ¶ster
    function checkTripMessage() {
      const urlParams = new URLSearchParams(window.location.search);
      let decodedFromName = '';
      let decodedToName = '';
      let decodedReason = '';
      
      // Ã–nce yeni kÄ±sa link formatÄ±nÄ± kontrol et (?t=...)
      const tripParam = urlParams.get('t');
      if (tripParam) {
        try {
          // Base64 decode ve URL-safe karakterleri geri Ã§evir
          const base64 = tripParam
            .replace(/-/g, '+')
            .replace(/_/g, '/');
          
          // Padding ekle (gerekirse)
          const padded = base64 + '='.repeat((4 - base64.length % 4) % 4);
          
          // Decode et
          const decoded = decodeURIComponent(atob(padded));
          const parts = decoded.split('|');
          
          if (parts.length === 3) {
            // Yeni format: fromName|toName|reason
            decodedFromName = parts[0];
            decodedToName = parts[1];
            decodedReason = parts[2];
          } else if (parts.length === 2) {
            // Eski format desteÄŸi (geriye dÃ¶nÃ¼k uyumluluk)
            decodedFromName = parts[0];
            decodedToName = parts[0]; // Eski linklerde sadece bir isim vardÄ±
            decodedReason = parts[1];
          }
        } catch (e) {
          console.error('Link decode hatasÄ±:', e);
          return false;
        }
      } 
      // Eski format desteÄŸi (geriye dÃ¶nÃ¼k uyumluluk iÃ§in)
      else {
        const personParam = urlParams.get('person');
        const reasonParam = urlParams.get('reason');
        
        if (personParam && reasonParam) {
          decodedFromName = decodeURIComponent(personParam);
          decodedToName = decodeURIComponent(personParam);
          decodedReason = decodeURIComponent(reasonParam);
        } else {
          return false;
        }
      }
      
      if (decodedFromName && decodedToName && decodedReason) {
        // TÃ¼m form elemanlarÄ±nÄ± gizle
        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.add('hidden');
        document.getElementById('result').classList.add('hidden');
        document.querySelector('.step-indicator').classList.add('hidden');
        document.querySelector('.subtitle').classList.add('hidden');
        document.querySelector('h1').classList.add('hidden');
        
        // Trip mesajÄ±nÄ± gÃ¶ster
        document.getElementById('tripFromName').textContent = decodedFromName;
        document.getElementById('tripToName').textContent = decodedToName;
        document.getElementById('tripReasonText').textContent = decodedReason;
        document.getElementById('tripMessage').classList.remove('hidden');
        
        // Sayfa baÅŸlÄ±ÄŸÄ±nÄ± gÃ¼ncelle
        document.title = `${decodedFromName} ${decodedToName}'e trip atÄ±yor!`;
        
        return true;
      }
      
      return false;
    }

    // Sayfa yÃ¼klendiÄŸinde kontrol et
    window.addEventListener('load', function() {
      // Ã–nce trip mesajÄ± var mÄ± kontrol et
      if (!checkTripMessage()) {
        // Trip mesajÄ± yoksa normal formu gÃ¶ster
        document.getElementById('yourName').focus();
      }
    });
  </script>
</body>
</html>
